import{j as r,F as O,a as y,t as f,u as $,G as F,T as k,B as D,b as R,I as S}from"./index-420191c7.js";import{bx as d,bD as M}from"./vendor-7927c036.js";import{i as w}from"./echarts-dc5acca6.js";const _=l=>{const{items:n,className:t}=l,o=d.useRef(null),p=n==null?void 0:n.map(s=>s.x),u=n==null?void 0:n.map(s=>s.y),e=d.useRef(!1),a=d.useRef();return d.useEffect(()=>{if(!o.current||e.current)return;a.current=w(o.current),e.current=!0;const s={tooltip:{trigger:"axis",show:!0,formatter:([{axisValue:i,data:g}])=>{const x=i.split("-"),c=`${x[0]}年${x[1]}月${x[2]}日`,m=g===null?"无数据":`${g}元`;return`${c}<br/><div style="text-align: right;">${m}</div>`}},grid:{left:16,top:8,bottom:24,right:16},xAxis:{type:"category",data:p,axisLabel:{formatter:i=>i.slice(i.indexOf("-")+1)}},yAxis:{type:"value",axisLabel:{show:!1}},series:[{data:u,type:"line",itemStyle:{},emphasis:{itemStyle:{color:"green"}}}]};a.current.setOption(s)},[]),d.useEffect(()=>{var i;const s={xAxis:{data:p},series:[{data:u}]};(i=a.current)==null||i.setOption(s)},[n]),r("div",{ref:o,className:t})},C=l=>{const{className:n,items:t=[]}=l,o=d.useRef(null),p=d.useRef(!1),u=d.useRef();return d.useEffect(()=>{if(!o.current||p.current)return;u.current=w(o.current),p.current=!0;const e={tooltip:{trigger:"item",formatter:({data:{name:a,value:s,sign:i}})=>`${i} ${a}: ${s}元`},grid:{top:0,left:0,bottom:0,right:0},series:[{type:"pie",radius:"90%",data:t.map((a,s)=>({...a,value:parseFloat(a.value.toString())}))}]};u.current.setOption(e)},[]),d.useEffect(()=>{var a;const e={series:[{data:t}]};(a=u.current)==null||a.setOption(e)},[t]),r(O,{children:r("div",{ref:o,className:n})})},E=["#5470c6","#ffbab0","#ffa750","#8748d3","#53a867","#eba953","#91cc75","#fac858","#ee6666","#73c0de"],A=l=>{const{className:n,items:t}=l,o=(t==null?void 0:t.reduce((e,a)=>e+parseFloat(a.value.toString()),0))??0,p=(t==null?void 0:t.reduce((e,a)=>Math.max(e,parseFloat(a.value.toString())),0))??0,u=()=>t==null?void 0:t.map((e,a)=>y("div",{grid:"","grid-cols":"[48px_1fr_1fr]","grid-rows":"[repeat(2,1fr)]","text-12px":"","items-center":"","gap-y-6px":"","gap-x-8px":"","px-16px":"","my-8px":"",children:[r("div",{"row-start-1":"","col-start-1":"","row-end-3":"","col-end-2":"","w-48px":"","h-48px":"","rounded-24px":"",bg:"#EFEFEF",flex:"","justify-center":"","items-center":"","text-24px":"",children:e.sign}),y("div",{"row-start-1":"","col-start-2":"","row-end-2":"","col-end-3":"","self-end":"",children:[e.name," — ",`${(parseFloat(e.value.toString())/o*100).toFixed(0)}%`]}),y("div",{"row-start-1":"","col-start-3":"","row-end-2":"","col-end-4":"","text-right":"","self-end":"",children:[e.value," 元"]}),r("div",{"row-start-2":"","col-start-2":"","row-end-3":"","col-end-4":"","h-8px":"","self-start":"","rounded-4px":"","overflow-hidden":"",bg:"#CCC",relative:"",children:r("div",{absolute:"","h-full":"","rounded-4px":"",style:{background:E[a],width:`${parseFloat(e.value.toString())/p*100}%`}})})]},e.name));return r("div",{className:n,children:t!=null&&t[0]?u():r("div",{"text-center":"",children:"暂无数据"})})},N="yyyy-MM-dd",b=({start:l,end:n,kind:t,group_by:o})=>`/api/v1/items/summary?happened_after=${l.format("yyyy-MM-dd")}&happened_before=${n.format("yyyy-MM-dd")}&kind=${t}&group_by=${o}`,T=()=>{const[l,n]=d.useState({name:"thisMonth",start:f().firstDayOfMonth,end:f().lastDayOfMonth.add(1,"day")}),[t,o]=d.useState("expenses"),{get:p}=$({showLoading:!1,handleError:!0}),u=c=>Array.from({length:e.dayCountOfMonth}).map((m,h)=>({x:e.clone.add(h,"day").format(N),y:0})),{start:e,end:a}=l,s=u(),{data:i}=M(b({start:e,end:a,kind:t,group_by:"happen_at"}),async c=>(await p(c)).data.groups.map(({happen_at:m,amount:h})=>({x:m,y:(h/100).toFixed(2)}))),g=s==null?void 0:s.map((c,m)=>(i==null?void 0:i.find(h=>h.x===c.x))||c),{data:x}=M(b({start:e,end:a,kind:t,group_by:"tag_id"}),async c=>(await p(c)).data.groups.map(({tag_id:m,tag:h,amount:v})=>({name:h.name,value:(v/100).toFixed(2),sign:h.sign})));return y("div",{children:[r(F,{children:r(k,{title:"统计图表",icon:r(D,{})})}),r(R,{selected:l,onSelect:n,timeRanges:[{text:"本月",key:{name:"thisMonth",start:f().firstDayOfMonth,end:f().lastDayOfMonth.add(1,"day")}},{text:"上月",key:{name:"lastMonth",start:f().add(-1,"month").firstDayOfMonth,end:f().add(-1,"month").lastDayOfMonth.add(1,"day")}},{text:"两个月前",key:{name:"twoMonthsAgo",start:f().add(-2,"month").firstDayOfMonth,end:f().add(-2,"month").lastDayOfMonth.add(1,"day")}},{text:"三个月前",key:{name:"threeMonthsAgo",start:f().add(-3,"month").firstDayOfMonth,end:f().add(-3,"month").lastDayOfMonth.add(1,"day")}}]}),y("div",{flex:"","p-16px":"","items-center":"","gap-x-16px":"",children:[r("span",{"grow-0":"","shrink-0":"",children:"类型"}),r("div",{"grow-1":"","shrink-1":"",children:r(S,{type:"select",options:[{text:"支出",value:"expenses"},{text:"收入",value:"income"}],value:t,onChange:c=>o(c),disableError:!0})})]}),r(_,{className:"h-120px",items:g}),r(C,{className:"h-260px m-t-16px",items:x}),r(A,{className:"m-t-8px",items:x})]})};export{T as default};
